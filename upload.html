<!DOCTYPE html>
<html>
<head>
    <meta name="google-signin-client_id" content="863132390401-cnvr6samr1ak3rpvhmmvas64r1iiv72v.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <title>Google Drive Upload</title>
</head>
<body>
    <h1>Upload File to Google Drive</h1>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload</button>

    <div id="status"></div>
    <div class="g-signin2" data-onsuccess="onSignIn"></div>
</body>

<script>
    gapi.load('client:auth2', initClient);
  </script>
  

<!-- Include the Google API Client Library -->
<script src="https://apis.google.com/js/api.js"></script>
<script async defer src="https://apis.google.com/js/api.js" onload="handleClientLoad()"></script>

<script>
  const clientId = '863132390401-cirnugjvu08lu2cc32jkjgsfov7u1b1a.apps.googleusercontent.com'; // Replace with your OAuth client ID
  const apiKey = 'AIzaSyCN5N-NZ7zxnbrBPCiL4JpidcIJ74KszZk'; // Replace with your API key
  const scope = 'https://www.googleapis.com/auth/drive'; // The scope needed to access Google Drive

  function handleClientLoad() {
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
  gapi.client.init({
    apiKey: apiKey,
    clientId: clientId,
    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    scope: scope
  }).then(function () {
    // Client is initialized and ready to use.

    // Check if the user is already signed in; if not, prompt for sign-in.
    if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
      gapi.auth2.getAuthInstance().signIn();
    }
  });
}




function uploadFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];

  const metadata = {
    name: file.name,
    mimeType: file.type
  };

  const reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onload = function (event) {
    const base64Data = event.target.result.split(',')[1];

    // Use the OAuth 2.0 access token to authenticate the API request.
  const authInstance = gapi.auth2.getAuthInstance();
  if (authInstance.isSignedIn.get()) {
    const user = authInstance.currentUser.get();
    const authResponse = user.getAuthResponse();
    const accessToken = authResponse.access_token;

    // Include the access token in the API request headers
    const uploadRequest = gapi.client.request({
      path: 'https://www.googleapis.com/upload/drive/v3/files',
      method: 'POST',
      params: {
        uploadType: 'media'
      },
      headers: {
        Authorization: `Bearer ${accessToken}`,
        'Content-Type': file.type
      },
      body: base64Data
    });

    uploadRequest.then(function (response) {
      displayStatus(`File uploaded successfully! ID: ${response.result.id}, Name: ${response.result.name}, Size: ${response.result.size}`);
    }).catch(function (error) {
      displayStatus(`Error uploading file: ${error.result.error.message}`);
    });
  };
}
}



  function displayStatus(message) {
    const statusDiv = document.getElementById('status');
    statusDiv.textContent = message;
  }
</script>




</html>
